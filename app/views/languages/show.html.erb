
<% provide(:title, 'Language Overview: ' + @language.name) %>

<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--6-col mdl-cell--2-col-phone">
    <h1>Language Overview</h1>
  </div>
  <div class="mdl-cell mdl-cell--4-offset-desktop mdl-cell--2-col">
    <div class="language-name"><h2><%= @language.name %></h2></div>
    <div class="iso-code">[<%= @language.iso %>]</div>
  </div>
</div>

<div class="mdl-grid language-dashboard">

  <!-- general language data -->
  <div class="language-info mdl-cell mdl-cell--4-col">
    <% if @language.population %>
      <p>
        <span id="pop_<%= @language.iso %>">
          Population: <strong><%= number_with_delimiter(@language.population, :delimiter => ',') %></strong>
        </span>
        <% if @language.pop_source %>
          <div class="mdl-tooltip" for="pop_<%= @language.iso %>">source: <%= @language.pop_source.name %></div>
        <% end %>
      </p>
    <% end %>
    <% if @language.family %>
        <p>Family: <strong><%= @language.family_name %></strong></p>
    <% end %>
    <% if @language.description.present? %>
        <p><%= @language.description %></p>
    <% end %>
    <% if @language.info.present? %>
        <p><%= @language.info %></p>
    <% end %>
    <% if @language.engaged_organisations.any? %>
        <h4>Organisations engaged with this language</h4>
        <ul class="mdl-list">
          <% @language.engaged_organisations.each do |org| %>
            <li class="mdl-list__item">
              <%= link_to org.name_with_abbr, org, class: 'mdl-list__item-primary-content' %>
            </li>
          <% end %>
        </ul>
    <% else %>
          <p><em>No organisations engaged with this language.</em></p>
    <% end %>
    <% if @language.iso.present? %>
        <div class="jp-data">
          <div class="center"><paper-spinner class="jp-fetch" active></paper-spinner></div>
          <%= link_to 'Fetch JP Data', fetch_jp_data_path(@language.iso), remote: true, class: 'hide', id: 'jp-fetch-trigger' %>
        </div>
    <% end %>
  </div>

  <div class="outcome-progress-cell mdl-cell mdl-cell--4-col">
    <h3>Outcome progress</h3>
    <% @language.state_languages.in_project.each do |state_language| %>
        <div><strong>...in <%= state_language.state_name %> of <%= state_language.geo_state.zone_name %> Zone</strong></div>
        <%= link_to "#{state_language.state_name} chart", language_outcomes_chart_path(id: state_language.id), remote: true, method: 'GET', class: "mdl-button mdl-js-button get-chart-button chart-#{state_language.id}-button" %>
        <div class="chart-<%= state_language.id %>"></div>
    <% end %>
    <% non_project_states = @language.state_languages.joins(:geo_state).where(project: false).pluck('geo_states.name').to_sentence %>
    <% if non_project_states.present? %>
        <p><%= @language.name %> is spoken in <%= non_project_states %>, but LCI does not track it there.</p>
    <% end %>
  </div>

  <!-- map -->
  <div class="mdl-cell mdl-cell--4-col">
    <% map = get_map(@language) %>
    <% if map %>
      <%= image_tag(map, alt: "Map for #{@language.name}", class: 'language-map mdl-shadow--2dp') %>
    <% end %>
  </div>

  <div class="mdl-cell mdl-cell--3-col">
    <h3>Translation Status</h3>
    <% if @language.number_of_translations && @language.number_of_translations > 0 %>
        <p>Already existing: <strong><%= @language.number_of_translations %></strong> Bible <%= 'version'.pluralize(@language.number_of_translations) %></p>
    <% end %>
    <div class="translation-status mdl-card mdl-shadow--2dp">
      <div class="mdl-card__title" style="background-color: <%= @language.translation_status_colour %>">
        <h2 class="mdl-card__title-text"><%= @language.translation_status.to_s.humanize %></h2>
      </div>
      <div class="mdl-card__supporting-text">
        <p>Translation need/status: <strong><%= @language.translation_need.humanize %></strong></p>
        <p>Translation progress: <strong><%= @language.translation_progress.humanize %></strong></p>
      </div>
    </div>

    <% if @language.translation_info.present? %>
        <p><%= @language.translation_info %></p>
    <% end %>
    <div>
      <% if @language.translating_organisations.any? %>
          <h4>Organisations involved with translation</h4>
          <ul class="mdl-list">
            <% @language.translating_organisations.each do |org| %>
              <li class="mdl-list__item">
                <%= link_to org.name_with_abbr, org, class: 'mdl-list__item-primary-content' %>
              </li>
            <% end %>
          </ul>
      <% else %>
          <p><em>No organisations engaged with translating for this language.</em></p>
      <% end %>
    </div>
  </div>
  <div class="mdl-cell mdl-cell--3-col">
    <% if @impact_report %>
      <div class="impact-story mdl-card mdl-shadow--2dp">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Impact Story</h2>
        </div>
        <div class="mdl-card__supporting-text">
          <div><%= time_ago_in_words(@impact_report.report_date) %> ago</div>
          <%= simple_format @impact_report.content %>
          <% @impact_report.pictures.each do |picture| %>
              <%= image_tag picture.ref_url if picture.ref? %>
          <% end %>
          <%# Show the reporter name if the logged in user is trusted, or if it's them. %>
          <% if @impact_report.reporter and (logged_in_user.trusted? or logged_in_user?(report.reporter)) %>
              <div class="reporter"><%= @impact_report.reporter.name %></div>
          <% end %>
        </div>
        <div class="mdl-card__actions">
          <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
            More impact stories...
          </a>
        </div>
      </div>
    <% else %>
      <p>No impact reports.</p>
    <% end %>
  </div>
  <div class="mdl-cell mdl-cell--3-col">
    <% if @language.mt_resources.any? %>
        <ul class="mdl-list">
        <% @language.mt_resources.each do |resource| %>
            <li class="mdl-list__item mdl-list__item--two-line">
                <span class="mdl-list__item-primary-content">
                <% if resource.url %>
                  <a href="<%= resource.url %>" tabindex="-1"><%= resource.name %></a>
                <% else %>
                  <%= resource.name %>
                <% end %>
                  <span class="mdl-list__item-sub-title"><%= resource.description %></span>
                </span>
            </li>
        <% end %>
        </ul>
    <% else %>
      <p>No mother-tongue resources.</p>
    <% end %>
  </div>
  <!--<div class="mdl-cell mdl-cell&#45;&#45;3-col">-->
    <!-- more content to come -->
  <!--</div>-->
</div>

<style is="custom-style" include="iron-flex">
  paper-spinner {
    margin: 2em;
  }
  .center {
    @apply(--layout-horizontal);
    @apply(--layout-center-justified);
  }
</style>

