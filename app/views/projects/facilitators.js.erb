$('#facs-panel').html('<%= j render 'facilitators' %>');
componentHandler.upgradeElements($('#facs-panel').find('.mdl-tooltip').get());
componentHandler.upgradeElements($('#facs-panel').find('.mdl-textfield').get());
componentHandler.upgradeElements($('#facs-panel').find('.mdl-checkbox').get());
$('#facs-tab').removeClass('dirty');

$('.amo-actual-input').on('input', function(){
    $(this).find('input').addClass('dirty');
});
$('.amo-actual-input').on('change', function(){
    $(this).closest('form').submit();
});


const dialog = document.getElementById('amo-comment');
if (! dialog.showModal) {
    dialogPolyfill.registerDialog(dialog);
}
$('.amo-info-button').on('click', function() {
    dialog.querySelector('.mdl-textfield').MaterialTextfield.change($(this).find('.variance-reason').text());
    $(dialog).find('.mdl-dialog__content input[name="amo_id"]').val($(this).parent().data('amo-id'));
    dialog.showModal();
});
dialog.querySelector('.close').addEventListener('click', function() {
    dialog.close();
});
dialog.querySelector('.submit').addEventListener('click', function() {
    $(dialog).find('form').submit();
    dialog.close();
});

const dialog2 = document.getElementById('sup-feedback-dialog');
if (! dialog2.showModal) {
    dialogPolyfill.registerDialog(dialog2);
}
$('.sup-feedback-button').on('click', function() {
    dialog2.querySelector('.sup-feedback').MaterialTextfield.change($(this).find('.sup-feedback').text());
    if (typeof $(this).data('sup-approved') == 'undefined') {
        dialog2.querySelector('.sup-approved').MaterialCheckbox.uncheck();
    } else {
        dialog2.querySelector('.sup-approved').MaterialCheckbox.check();
    }
    $(dialog2).find('.mdl-textfield, .mdl-checkbox').data('sup-feedback-id', $(this).data('sup-feedback-id'));
    dialog2.showModal();
});
$(dialog2).find('.sup-feedback').on('change', function(){
    const url = '<%= supervisor_feedback_path('sf-placeholder') %>'.replace('sf-placeholder', $(this).data('sup-feedback-id'));
    $.ajax({
        url: url,
        method: 'PUT',
        dataType: 'JSON',
        data: {supervisor_feedback: {result_feedback: $(this).find('textarea').val()}}
    });
});
$(dialog2).find('.sup-approved').on('change', function(){
    const url = '<%= supervisor_feedback_path('sf-placeholder') %>'.replace('sf-placeholder', $(this).data('sup-feedback-id'));
    $.ajax({
        url: url,
        method: 'PUT',
        dataType: 'JSON',
        data: {supervisor_feedback: {report_approved: $(this).find('input').is(':checked')}}
    });
});
dialog2.querySelector('.close').addEventListener('click', function() {
    dialog2.close();
});